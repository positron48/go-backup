---
# Example configuration file for goback
# Copy this file to config.yaml and customize it for your needs

# Global backup settings
global:
  # Directory for storing all backups
  backup_dir: "/var/www/backups"
  
  # Global retention policy for backups
  # The tool automatically determines anchor points (daily, weekly, monthly, yearly)
  # and keeps the specified number of backups for each type
  retention:
    daily: 2      # Number of daily backups to keep
    weekly: 2     # Number of weekly backups to keep
    monthly: 2    # Number of monthly backups to keep
    yearly: 2     # Number of yearly backups to keep
  
  # Filename mask for backup files: %name%-YmdHis
  # Example: budget-20241214153045
  # Available variables:
  #   %name% - backup name
  #   %Y% - year (4 digits)
  #   %m% - month (2 digits)
  #   %d% - day (2 digits)
  #   %H% - hour (2 digits)
  #   %M% - minute (2 digits)
  #   %S% - second (2 digits)
  filename_mask: "%name%-%Y%m%d%H%M%S"
  
  # Default compression type (gzip, zip, tar, tar.gz, none)
  # Can be overridden for each backup individually
  default_compression: "gzip"
  
  # Pre-execution commands (pre-hooks) - optional
  # Executed before all backups start
  pre_hooks:
    # - "systemctl stop some-service"
    # - "echo 'Starting backup process'"
  
  # Post-execution commands (post-hooks) - optional
  # Executed after all backups complete
  post_hooks:
    # - "systemctl start some-service"
    # - "echo 'Backup completed'"
  
  # Directory with additional backup configuration files
  # The tool will read all .yaml and .yml files from this directory
  # Each file should contain one backup configuration (without array wrapper)
  # 
  # Example structure of a backup file in include_dir:
  # name: "backup-name"
  # subdirectory: "project-name"
  # source_dir: "/path/to/source"
  # exclude_patterns:
  #   - "*.log"
  # compression: "gzip"
  #
  # If include_dir is specified, the tool will automatically load all backups from this directory
  # and merge them with backups specified in the backups section below
  include_dir: "/var/www/my/backup/backups"

# List of backups (optional, you can use include_dir instead)
# If include_dir is specified, the tool will automatically read all .yaml and .yml files from that directory
# Each file should contain one backup configuration (without array wrapper)
# 
# Alternatively, you can specify backups directly here:
backups:
  # Example 1: Directory backup with exclusions
  - name: "example-website"
    subdirectory: "example"
    source_dir: "/var/www/example"
    # Patterns for excluding files/directories (glob patterns)
    exclude_patterns:
      - "var/cache/*"
      - "vendor/*"
      - "*.log"
      - "node_modules/*"
    # Compression type (overrides default_compression)
    compression: "zip"
    # Retention policy (overrides global policy)
    retention:
      daily: 3
      weekly: 2
      monthly: 2
      yearly: 1

  # Example 2: Directory backup with minimal settings
  # Uses global settings by default
  - name: "simple-backup"
    subdirectory: "simple"
    source_dir: "/var/www/simple"

  # Example 3: Backup via command execution (e.g., database dump)
  - name: "database-dump"
    subdirectory: "databases"
    # Command to execute (e.g., mysqldump, pg_dump)
    command: "mysqldump -u user -ppassword database_name"
    # Output file name (will be used in filename_mask)
    output_file: "database.sql"
    compression: "gzip"
    retention:
      daily: 7
      weekly: 4
      monthly: 6
      yearly: 2

  # Example 4: PostgreSQL database backup
  - name: "postgres-backup"
    subdirectory: "databases"
    command: "pg_dump -U postgres my_database"
    output_file: "postgres.sql"
    compression: "tar.gz"
    retention:
      daily: 5
      weekly: 3
      monthly: 3
      yearly: 1

  # Example 5: Backup with tar compression
  - name: "project-backup"
    subdirectory: "projects"
    source_dir: "/var/www/project"
    exclude_patterns:
      - "*.tmp"
      - ".git/*"
    compression: "tar"
    retention:
      daily: 2
      weekly: 2
      monthly: 2
      yearly: 2

  # Example 6: Backup without compression
  - name: "uncompressed-backup"
    subdirectory: "raw"
    source_dir: "/var/www/raw"
    compression: "none"

# Example backup file in include_dir (/var/www/my/backup/backups/positroid-blog.yaml):
# ---
# # Backup of positroid.tech blog directory
# name: "positroid-blog"
# subdirectory: "positroid.tech"
# source_dir: "/var/www/positroid.tech"
# exclude_patterns:
#   - "var/cache/*"
#   - "vendor/*"
# # Compression: zip (as in original script)
# compression: "zip"
# # Backup retention policy (overrides global policy)
# retention:
#   daily: 2
#   weekly: 2
#   monthly: 2
#   yearly: 2
# ---
